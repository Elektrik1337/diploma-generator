<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Диплом</title>

  <style>
    :root{
      --panel: rgba(255,255,255,.16);
      --panel2: rgba(255,255,255,.22);
      --text: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.82);
      --shadow: 0 18px 50px rgba(0,0,0,.22);
      --radius: 22px;
    }

    @font-face{
      font-family: "TT Lovelies Script";
      src: url("./TT%20Lovelies%20Script.woff2?v=40") format("woff2");
      font-display: swap;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px;
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(255,255,255,.22), transparent 60%),
        radial-gradient(900px 600px at 80% 20%, rgba(255,255,255,.16), transparent 55%),
        linear-gradient(180deg, #66b7ff, #2c7ec6);
    }

    .wrap{
      width:min(980px,100%);
      display:grid;
      gap: 14px;
    }

    .panel{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border: 1px solid rgba(255,255,255,.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      backdrop-filter: blur(10px);
    }

    /* ===== КНОПКИ СВЕРХУ ===== */
    .actions{
      display:none;
      justify-content:center;
      gap: 12px;
      flex-wrap:wrap;
    }

    button{
      border:0;
      border-radius: 999px;
      padding: 12px 20px;
      font-size: 16px;
      cursor:pointer;
      transition: transform .06s ease, filter .2s ease, opacity .2s ease;
      user-select:none;
      white-space:nowrap;
    }
    button:active{ transform: translateY(1px); }

    .btn-secondary{
      background: rgba(255,255,255,.18);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.22);
    }

    /* ===== ПАНЕЛЬ ВВОДА (ДО ГЕНЕРАЦИИ) ===== */
    .input-panel{
      display:grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 14px;
      align-items:center;
    }

    .hero{
      display:grid;
      gap: 8px;
    }
    .hero .line1{
      font-size: 22px;
      font-weight: 600;
    }
    .hero .line2{
      font-size: 15px;
      color: var(--muted);
    }

    .controls{
      display:grid;
      gap: 10px;
      justify-items:end;
    }

    input{
      width: 100%;
      max-width: 520px;
      appearance:none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.12);
      color: var(--text);
      border-radius: 999px;
      padding: 12px 14px;
      outline:none;
      font-size: 16px;
    }

    .btn-primary{
      background: rgba(255,255,255,.94);
      color: #1b2f52;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
    }

    .btn-disabled{
      opacity:.55;
      cursor:not-allowed;
    }

    /* ===== ДИПЛОМ ===== */
    .preview{
      display:none;
      place-items:center;
      padding: 14px;
    }
    canvas{
      width: min(900px, 100%);
      height:auto;
      border-radius: 18px;
      box-shadow: 0 16px 40px rgba(0,0,0,.22);
      background: transparent;
    }

    @media (max-width: 760px){
      .input-panel{ grid-template-columns: 1fr; }
      .controls{ justify-items: stretch; }
      button{ width: 100%; }
    }
  </style>
</head>

<body>
<div class="wrap">

  <!-- ПАНЕЛЬ ВВОДА -->
  <div id="inputPanel" class="panel input-panel">
    <div class="hero">
      <div class="line1">Введи имя и фамилию — получи диплом</div>
      <div class="line2">Например: Иван Петров</div>
    </div>

    <div class="controls">
      <input id="fio" placeholder="Имя Фамилия" />
      <button id="gen" class="btn-primary btn-disabled" disabled>Получить диплом</button>
    </div>
  </div>

  <!-- КНОПКИ СВЕРХУ ДИПЛОМА -->
  <div id="actionsPanel" class="panel actions">
    <button id="dl" class="btn-secondary">Скачать диплом</button>
    <button id="reset" class="btn-secondary">Сделать ещё</button>
  </div>

  <!-- ДИПЛОМ -->
  <div id="preview" class="panel preview">
    <canvas id="c"></canvas>
  </div>

</div>

<script>
  const inputPanel = document.getElementById('inputPanel');
  const actionsPanel = document.getElementById('actionsPanel');
  const previewBox = document.getElementById('preview');

  const fioInput = document.getElementById('fio');
  const genBtn = document.getElementById('gen');
  const dlBtn = document.getElementById('dl');
  const resetBtn = document.getElementById('reset');

  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  const diplomaImg = new Image();
  diplomaImg.src = './template.png?v=40';

  // === ТВОИ КООРДИНАТЫ ===
  const NAME_X = 1287;
  const NAME_Y = 1320
;

  const NAME_COLOR = '#3D4E7E';

  function normalizeFio(s){
    return s.replace(/\s+/g,' ').trim();
  }

  fioInput.addEventListener('input', () => {
    const ok = normalizeFio(fioInput.value).length >= 3;
    genBtn.disabled = !ok;
    genBtn.classList.toggle('btn-disabled', !ok);
  });

  function splitToTwoLines(text){
    const p = text.split(' ');
    if (p.length <= 2) return [text];
    return [p.slice(0,-1).join(' '), p[p.length-1]];
  }

  function fitFontSize(text, maxWidth){
    for(let s=150; s>=64; s-=2){
      ctx.font = `${s}px "TT Lovelies Script"`;
      if(ctx.measureText(text).width <= maxWidth) return s;
    }
    return 64;
  }

  function drawDiploma(fio){
    canvas.width = diplomaImg.naturalWidth;
    canvas.height = diplomaImg.naturalHeight;

    ctx.drawImage(diplomaImg,0,0);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = NAME_COLOR;

    const lines = splitToTwoLines(fio);
    const longest = lines.reduce((a,b)=>a.length>b.length?a:b,'');
    const size = fitFontSize(longest, canvas.width*0.86);

    ctx.font = `${size}px "TT Lovelies Script"`;

    const gap = size*0.8;

    if(lines.length===1){
      ctx.fillText(lines[0], NAME_X, NAME_Y);
    }else{
      ctx.fillText(lines[0], NAME_X, NAME_Y-gap/2);
      ctx.fillText(lines[1], NAME_X, NAME_Y+gap/2);
    }
  }

  genBtn.addEventListener('click', async () => {
    const fio = normalizeFio(fioInput.value);
    if(!fio) return;

    if(!diplomaImg.complete){
      await new Promise(r=>diplomaImg.onload=r);
    }
    await document.fonts.load('80px "TT Lovelies Script"');

    drawDiploma(fio);

    inputPanel.style.display='none';
    actionsPanel.style.display='flex';
    previewBox.style.display='grid';
  });

  dlBtn.addEventListener('click',()=>{
    const a=document.createElement('a');
    a.download='diploma.png';
    a.href=canvas.toDataURL('image/png');
    a.click();
  });

  resetBtn.addEventListener('click',()=>{
    fioInput.value='';
    genBtn.disabled=true;
    genBtn.classList.add('btn-disabled');

    inputPanel.style.display='grid';
    actionsPanel.style.display='none';
    previewBox.style.display='none';
  });
</script>
</body>
</html>
